<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Resources Center</title>
    <link rel="stylesheet" href="/styles.css?v=1744154000">
    <!-- Add favicon -->
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico?v=1744154000">
    <!-- Add Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="logo">
            <h1>Study Resources Center</h1>
        </div>
        <nav>
            <ul>
                <li><a href="/"><i class="fas fa-home"></i> Activities</a></li>
                <li><a href="/chat.html"><i class="fas fa-comments"></i> Study Groups</a></li>
                <li><a href="/ai-chat.html"><i class="fas fa-robot"></i> Homework Help</a></li>
                <li><a href="/login.html" id="loginBtn"><i class="fas fa-sign-in-alt"></i> Login</a></li>
                <li><a href="/signup.html" id="signupBtn"><i class="fas fa-user-plus"></i> Sign Up</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="hero">
            <h1 id="title">Study Resources Center</h1>
            <h2 id="sub">Access educational resources from anywhere!</h2>

            <!-- Language fact message that dynamically changes -->
            <p class="fact-message">Language fact: The most common letter in English is 'e'.</p>

            <!-- Proxy Search Bar -->
            <div class="proxy-container">
                <h3>Web Proxy</h3>
                <p class="proxy-description">Access educational websites through our secure proxy</p>
                <form id="searchForm" class="proxy-form">
                    <input id="searchbar" type="text" placeholder="Search the web or enter a URL" class="proxy-input">
                    <button type="submit" class="proxy-button"><i class="fas fa-search"></i> Go</button>
                </form>
            </div>

            <p>Games, chat rooms, and AI chat - all in one place that bypasses restrictions!</p>
        </section>

        <section class="games-section">
            <h2>Featured Games</h2>
            <div class="games-grid">
                <!-- Game placeholders -->
                <div class="game-card">
                    <div class="game-img placeholder"></div>
                    <h3>Snake Game</h3>
                    <a href="/activities/logic_puzzle.html" class="play-btn">Play Now</a>
                </div>
                <div class="game-card">
                    <div class="game-img placeholder"></div>
                    <h3>Coming Soon</h3>
                    <a href="#" class="play-btn">Coming Soon</a>
                </div>
                <div class="game-card">
                    <div class="game-img placeholder"></div>
                    <h3>Coming Soon</h3>
                    <a href="#" class="play-btn">Coming Soon</a>
                </div>
                <div class="game-card">
                    <div class="game-img placeholder"></div>
                    <h3>Coming Soon</h3>
                    <a href="#" class="play-btn">Coming Soon</a>
                </div>
            </div>
        </section>
        
        <!-- Add quick links section similar to 55gms -->
        <section class="quicklinks-section">
            <h2>Quick Access</h2>
            <div class="quicklinks">
                <a class="quicklink" onclick="window.uv ? redirectToProxy('https://google.com') : hire('https://google.com')">
                    <img class="shortcut" src="https://www.google.com/favicon.ico" alt="Google">
                    <span>Google</span>
                </a>
                <a class="quicklink" onclick="window.uv ? redirectToProxy('https://youtube.com') : hire('https://youtube.com')">
                    <img class="shortcut" src="https://www.youtube.com/favicon.ico" alt="YouTube">
                    <span>YouTube</span>
                </a>
                <a class="quicklink" onclick="window.uv ? redirectToProxy('https://wikipedia.org') : hire('https://wikipedia.org')">
                    <img class="shortcut" src="https://en.wikipedia.org/favicon.ico" alt="Wikipedia">
                    <span>Wikipedia</span>
                </a>
                <a class="quicklink" onclick="window.uv ? redirectToProxy('https://quizlet.com') : hire('https://quizlet.com')">
                    <img class="shortcut" src="https://quizlet.com/favicon.ico" alt="Quizlet">
                    <span>Quizlet</span>
                </a>
                <a class="quicklink" onclick="window.uv ? redirectToProxy('https://khanacademy.org') : hire('https://khanacademy.org')">
                    <img class="shortcut" src="https://www.khanacademy.org/favicon.ico" alt="Khan Academy">
                    <span>Khan Academy</span>
                </a>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2023 Study Resources Center. All rights reserved.</p>
    </footer>

    <!-- Ultraviolet proxy scripts -->
    <script src="/assets/js/randomSentence.js?v=1744154000"></script>
    <script type="module" src="/js/main.js?v=1744154000"></script>
    <!-- Load the proxy handling scripts -->
    <script src="/assets/uv/bare.js?v=1744154000"></script>
    <script src="/assets/uv/wm.js?v=1744154000"></script>
    <script src="/assets/uv/uv.config.js?v=1744154000"></script>
    <script src="/assets/uv/uv.bundle.js?v=1744154000"></script>
    <script src="/assets/uv/uv.handler.js?v=1744154000"></script>
    <script src="/assets/uv/js/hiring.js?v=1744154000"></script>
    <script type="module" src="/js/proxy.js?v=1744154000"></script>
    
    <!-- Service Worker Registration -->
    <script>
      // Function to register the service worker
      async function registerServiceWorker() {
        // Set a global flag to track the registration status
        window.__uvRegistrationAttempted = true;
        
        if ('serviceWorker' in navigator) {
          try {
            console.log('Registering UV service worker...');
            
            // Check if we're in a secure context
            const isSecureContext = window.isSecureContext || location.protocol === 'https:' || 
                location.hostname === 'localhost' || location.hostname === '127.0.0.1';
                
            if (!isSecureContext) {
              // Log more details about the environment
              console.warn('Not in a secure context, service worker registration will fail');
              console.warn(`Protocol: ${location.protocol}, Hostname: ${location.hostname}`);
              console.warn(`isSecureContext: ${window.isSecureContext ? 'true' : 'false'}`);
              
              // Set a global flag for insecure context
              window.__uvInsecureContext = true;
              
              // Add notification for user about insecure context
              const warningEl = document.createElement('div');
              warningEl.style.background = '#ffebee';
              warningEl.style.color = '#c62828';
              warningEl.style.padding = '10px';
              warningEl.style.margin = '10px 0';
              warningEl.style.borderRadius = '5px';
              warningEl.style.position = 'fixed';
              warningEl.style.top = '0';
              warningEl.style.left = '0';
              warningEl.style.right = '0';
              warningEl.style.zIndex = '9999';
              warningEl.style.textAlign = 'center';
              warningEl.innerHTML = `
                <p>⚠️ Secure connection required for proxy functionality</p>
                <p>Current URL: ${location.protocol}//${location.host}</p>
                <p>Please use HTTPS or localhost.</p>
                <button id="dismissWarning" style="background: #c62828; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; margin-top: 5px;">Dismiss</button>
              `;
              document.body.appendChild(warningEl);
              
              // Add event listener to dismiss button
              setTimeout(() => {
                const dismissBtn = document.getElementById('dismissWarning');
                if (dismissBtn) {
                  dismissBtn.addEventListener('click', () => {
                    if (warningEl.parentNode) {
                      warningEl.parentNode.removeChild(warningEl);
                    }
                  });
                }
              }, 100);
              
              // Enable fallback mode without service worker
              console.log('Enabling proxy fallback mode without service worker');
              window.__uvFallbackMode = true;
            }
            
            // Get the configured path from the UV config with cache busting
            const swPath = `/assets/uv/uv.sw.js?v=${Date.now()}`;
            
            // Register the service worker with scope set to /service/
            const registration = await navigator.serviceWorker.register(swPath, {
              scope: '/service/',
              updateViaCache: 'none' // Don't use cached versions
            });
            
            console.log('UV Service worker registered successfully:', registration.scope);
            
            // Initialize bare client
            window.bareClient = new BareClient('/bare-server/');
            
            // Check server connection
            try {
              console.log('Checking bare server connection...');
              const data = await window.bareClient.ping();
              console.log('Bare server connected successfully:', data);
            } catch (error) {
              console.error('Error connecting to bare server:', error);
              
              // Try fallback to bare-info endpoint
              try {
                const response = await fetch('/bare-info/');
                if (response.ok) {
                  const data = await response.json();
                  console.log('Connected to bare-info fallback:', data);
                }
              } catch (fallbackError) {
                console.error('All bare server connection attempts failed');
              }
            }
          } catch (error) {
            console.error('Service worker registration failed:', error);
            // Log more details about the error
            console.error('Error name:', error.name);
            console.error('Error message:', error.message);
            console.error('Error stack:', error.stack);
            
            // Set a global flag for failed registration
            window.__uvRegistrationFailed = true;
            
            // Show a user-friendly error message
            const errorContainer = document.createElement('div');
            errorContainer.style.background = '#fff3cd';
            errorContainer.style.color = '#856404';
            errorContainer.style.padding = '15px';
            errorContainer.style.margin = '15px 0';
            errorContainer.style.borderRadius = '5px';
            errorContainer.style.border = '1px solid #ffeeba';
            errorContainer.innerHTML = `
              <h3 style="margin-top:0">Proxy Service Error</h3>
              <p>The web proxy service encountered an error: ${error.message || 'Unknown error'}</p>
              <p>You can still use other features of the site, but proxy functionality will be limited.</p>
              <button id="dismissError" style="background: #856404; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; margin-top: 5px;">Dismiss</button>
            `;
            
            // Insert after header or at top of main content
            const mainContent = document.querySelector('main') || document.body;
            mainContent.insertBefore(errorContainer, mainContent.firstChild);
            
            // Add event listener to dismiss button
            setTimeout(() => {
              const dismissBtn = document.getElementById('dismissError');
              if (dismissBtn) {
                dismissBtn.addEventListener('click', () => {
                  if (errorContainer.parentNode) {
                    errorContainer.parentNode.removeChild(errorContainer);
                  }
                });
              }
            }, 100);
            
            // Enable fallback mode without service worker
            console.log('Enabling proxy fallback mode without service worker');
            window.__uvFallbackMode = true;
          }
        } else {
          console.warn('Service workers are not supported in this browser');
          // Set a global flag for unsupported browser
          window.__uvUnsupportedBrowser = true;
        }
      }
      
      // Wait for scripts to load and then register the service worker
      window.addEventListener('load', () => {
        // Allow scripts to initialize properly
        setTimeout(() => {
          registerServiceWorker();
        }, 500);
      });
    </script>
</body>
</html> 